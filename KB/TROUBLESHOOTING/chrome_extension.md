# Chrome Extension Troubleshooting

> Stand: 2026-01-29

---

## System-Konfiguration (Windows)

### Dateipfade

| Datei | Pfad |
|-------|------|
| Native Messaging Host Config | `%LOCALAPPDATA%\Google\Chrome\User Data\NativeMessagingHosts\com.anthropic.claude_code_browser_extension.json` |
| Native Host Batch | `%USERPROFILE%\.claude\chrome\chrome-native-host.bat` |
| Claude Code CLI | `%APPDATA%\npm\node_modules\@anthropic-ai\claude-code\cli.js` |

### Native Messaging Host Config Inhalt

```json
{
  "name": "com.anthropic.claude_code_browser_extension",
  "description": "Claude Code Chrome Extension Native Host",
  "path": "C:\\Users\\andre\\.claude\\chrome\\chrome-native-host.bat",
  "type": "stdio",
  "allowed_origins": [
    "chrome-extension://fcoeoabgfenejglbffodgkkbkcdhcgfn/"
  ]
}
```

### Native Host Batch Inhalt

```batch
@echo off
REM Chrome native host wrapper script
REM Generated by Claude Code - do not edit manually
"C:\Program Files\nodejs\node.exe" "C:\Users\andre\AppData\Roaming\npm\node_modules\@anthropic-ai\claude-code\cli.js" --chrome-native-host
```

---

## Architektur

### Prozesse (bei laufender Session)

| Prozess | Flag | Funktion |
|---------|------|----------|
| node.exe | `--dangerously-skip-permissions` | Haupt-CLI |
| node.exe | `--claude-in-chrome-mcp` | MCP Server fuer Chrome |

- MCP Server startet ca. 2 Sekunden nach Haupt-CLI (lazy loading)
- Kommunikation via Named Pipe: `\\.\pipe\claude-mcp-browser-bridge-<username>`

### Verbindungsweg

```
Claude Code CLI
    |
    v
MCP Server (--claude-in-chrome-mcp)
    | Named Pipe
    v
Chrome Extension
    | Native Messaging (stdio)
    v
Native Host Batch (--chrome-native-host)
```

---

## Bekannte Probleme

### 1. EADDRINUSE - Named Pipe blockiert

**Symptom:** Fehlermeldung "EADDRINUSE" beim Start

**Ursache:** Alte Node-Prozesse von vorherigen Sessions blockieren den Pipe

**Diagnose:**
```powershell
# Laufende Node-Prozesse anzeigen
Get-Process node | Select-Object Id, ProcessName, StartTime

# Details mit CommandLine
wmic process where "name='node.exe'" get ProcessId,CreationDate,CommandLine /format:list
```

**Loesung:**
```powershell
# Alte Prozesse beenden (NICHT die aktuelle Session!)
taskkill /F /PID <alte_pid>
```

**ACHTUNG:** Nur Prozesse mit altem Timestamp beenden!

---

### 2. Claude Desktop vs Claude Code Konflikt

**Symptom:** Extension verbindet sich mit falschem Backend

**Hintergrund:** Claude Desktop und Claude Code nutzen unterschiedliche Native Messaging Hosts:
- Claude Desktop: `com.anthropic.claude_browser_extension.json`
- Claude Code: `com.anthropic.claude_code_browser_extension.json` (mit "code")

**Diagnose:**
```powershell
dir "$env:LOCALAPPDATA\Google\Chrome\User Data\NativeMessagingHosts\*claude*"
```

**Loesung (Mac - von Community):**
```bash
# Claude Desktop Host deaktivieren
mv ~/Library/Application\ Support/Google/Chrome/NativeMessagingHosts/com.anthropic.claude_browser_extension.json \
   ~/Library/Application\ Support/Google/Chrome/NativeMessagingHosts/com.anthropic.claude_browser_extension.json.disabled
```

**Windows Aequivalent:**
```powershell
# Falls beide existieren und Desktop stoert:
ren "%LOCALAPPDATA%\Google\Chrome\User Data\NativeMessagingHosts\com.anthropic.claude_browser_extension.json" "com.anthropic.claude_browser_extension.json.disabled"
```

---

### 3. Extension nicht verbunden trotz korrekter Prozesse

**Symptom:** `tabs_context_mcp` gibt "Browser extension is not connected" zurueck, obwohl:
- Nur aktuelle Node-Prozesse laufen
- Native Host Config korrekt ist
- Extension in Chrome installiert ist

**Moegliche Ursachen:**
- [ ] Chrome wurde nach Prozess-Neustart nicht neu gestartet
- [ ] Extension ist deaktiviert
- [ ] Extension hat falsche Permissions
- [ ] Native Host Batch ist nicht ausfuehrbar
- [ ] Firewall/Antivirus blockiert Named Pipe

**Noch zu pruefen:**
- Extension-Status in `chrome://extensions`
- Extension-Console-Logs (Rechtsklick > Inspect)
- Windows Event Log fuer Fehler

---

## Diagnose-Befehle Sammlung

```powershell
# Node-Prozesse mit Details
wmic process where "name='node.exe'" get ProcessId,CreationDate,CommandLine /format:list

# Native Host Configs auflisten
dir "$env:LOCALAPPDATA\Google\Chrome\User Data\NativeMessagingHosts\*claude*"

# Native Host Config lesen
type "$env:LOCALAPPDATA\Google\Chrome\User Data\NativeMessagingHosts\com.anthropic.claude_code_browser_extension.json"

# Batch-Script pruefen
type "$env:USERPROFILE\.claude\chrome\chrome-native-host.bat"

# Alle Node-Prozesse beenden (Vorsicht!)
taskkill /F /IM node.exe
```

---

## Extension-Konfiguration (verifiziert 2026-01-29)

### Installierte Extension

| Feld | Wert |
|------|------|
| Name | Claude |
| Version | 1.0.41 |
| ID | `fcoeoabgfenejglbffodgkkbkcdhcgfn` |
| Groesse | 10,1 MB |
| Quelle | Chrome Web Store |
| Status | Aktiviert |

### Berechtigungen (alle vorhanden)

- Auf das Backend fuer Seiten-Debugger zugreifen
- Alle deine Daten auf allen Websites lesen und aendern
- Benachrichtigungen einblenden
- Downloads verwalten
- **Mit zusammenarbeitenden nativen Anwendungen kommunizieren** (kritisch!)
- Tabgruppen ansehen und verwalten

### Websitezugriff

- Zugriff: "Auf allen Websites"
- Zugriff auf Datei-URLs: AUS
- Fehler erfassen: AUS
- Im Inkognitomodus: AUS

### ID-Abgleich

Native Host Config `allowed_origins` muss mit Extension-ID uebereinstimmen:
- Config: `chrome-extension://fcoeoabgfenejglbffodgkkbkcdhcgfn/` ✓
- Chrome: `fcoeoabgfenejglbffodgkkbkcdhcgfn` ✓

---

## Offene Fragen

1. Warum verbindet sich die Extension nicht, obwohl alles korrekt aussieht?
2. Service Worker Logs pruefen - Fehler?
3. Muss Chrome mit speziellen Flags gestartet werden?

---

## Changelog

- 2026-01-29: Initiale Dokumentation aus Troubleshooting-Session
